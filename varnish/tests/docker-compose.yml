version: '3'

services:
  varnish:
    image: starkandwayne/varnish:edge
    command: "start starkandwayne/varnish --group varnish"
    environment:
      HAB_VARNISH: |
        [backend]
        host="webserver"
        port="3000"
        max_connections=300

  webserver:
    image: trinitronx/python-simplehttpserver
    command: "python -m SimpleHTTPServer 3000"

  tests:
    image: starkandwayne-varnish-tests
    build: ./
    environment:
      VARNISH_HOST: varnish
